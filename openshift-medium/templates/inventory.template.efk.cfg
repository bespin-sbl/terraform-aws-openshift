# OpenShift Inventory Template.
# Note that when the infrastructure is generated by Terraform, this file is
# expanded into './inventory.cfg', based on the rules in:
#
#   ./modules/openshift/08-inventory.tf

# Create an OSEv3 group that contains the masters and nodes groups
[OSEv3:children]
masters
etcd
nodes

# Set variables common for all OSEv3 hosts
[OSEv3:vars]
# SSH user, this user should allow ssh based auth without requiring a password
ansible_ssh_user=ec2-user

# If ansible_ssh_user is not root, ansible_become must be set to true
ansible_become=true

# Deploy OpenShift Origin 3.9.
openshift_deployment_type=origin
openshift_release=v3.9

# We need a wildcard DNS setup for our public access to services, fortunately
# we can use the superb xip.io to get one for free.
openshift_public_hostname=${public_hostname}
openshift_master_default_subdomain=${default_subdomain}

# Use an htpasswd file as the indentity provider.
openshift_master_identity_providers=[{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider', 'filename': '/etc/origin/master/htpasswd'}]

# Uncomment the line below to enable metrics for the cluster.
# openshift_hosted_metrics_deploy=true

# Use API keys rather than instance roles so that tenant containers don't get
# Openshift's EC2/EBS permissions
openshift_cloudprovider_kind=aws
openshift_cloudprovider_aws_access_key=${access_key}
openshift_cloudprovider_aws_secret_key=${secret_key}

# Set the cluster_id.
openshift_clusterid=${cluster_id}

# Enable ntp on masters to ensure proper failover
openshift_clock_enabled=true

# Set EFK
openshift_logging_use_ops=False
openshift_logging_master_url="${public_hostname}"
openshift_logging_master_public_url="${public_hostname}"
openshift_logging_nodeselector=null
openshift_logging_labels={}
openshift_logging_label_key=""
openshift_logging_label_value=""
openshift_logging_install_logging=True

openshift_logging_purge_logging=False
openshift_logging_image_pull_secret=""

openshift_logging_image="{{ l_os_registry_url | regex_replace(l_openshift_logging_search | regex_escape, 'logging-deployer') }}"

openshift_logging_curator_default_days=30
openshift_logging_curator_run_hour=3
openshift_logging_curator_run_minute=30
openshift_logging_curator_run_timezone=UTC
openshift_logging_curator_timeout=300
openshift_logging_curator_script_log_level=INFO
openshift_logging_curator_log_level=ERROR
openshift_logging_curator_cpu_limit=null
openshift_logging_curator_memory_limit=256Mi
openshift_logging_curator_cpu_request=100m
openshift_logging_curator_nodeselector={}

openshift_logging_curator_ops_default_days=30
openshift_logging_curator_ops_run_hour=3
openshift_logging_curator_ops_run_minute=30
openshift_logging_curator_ops_run_timezone=UTC
openshift_logging_curator_ops_cpu_limit=null
openshift_logging_curator_ops_memory_limit=256Mi
openshift_logging_curator_ops_cpu_request=100m
openshift_logging_curator_ops_nodeselector={}

openshift_logging_kibana_hostname="{{ 'kibana.' ~ openshift_master_default_subdomain }}"
openshift_logging_kibana_cpu_limit=null
openshift_logging_kibana_memory_limit=736Mi
openshift_logging_kibana_cpu_request=100m
openshift_logging_kibana_proxy_debug=false
openshift_logging_kibana_proxy_cpu_limit=null
openshift_logging_kibana_proxy_memory_limit=256Mi
openshift_logging_kibana_proxy_cpu_request=100m
openshift_logging_kibana_replica_count=1
openshift_logging_kibana_edge_term_policy=Redirect

openshift_logging_kibana_nodeselector={}
openshift_logging_kibana_ops_nodeselector={}

#The absolute path on the control node to the cert file to use
#for the public facing kibana certs
openshift_logging_kibana_cert=""

#The absolute path on the control node to the key file to use
#for the public facing kibana certs
openshift_logging_kibana_key=""

#The absolute path on the control node to the CA file to use
#for the public facing kibana certs
openshift_logging_kibana_ca=""

openshift_logging_kibana_ops_hostname="{{ 'kibana-ops.' ~ openshift_master_default_subdomain }}"
openshift_logging_kibana_ops_cpu_limit=null
openshift_logging_kibana_ops_memory_limit=736Mi
openshift_logging_kibana_ops_cpu_request=100m
openshift_logging_kibana_ops_proxy_debug=false
openshift_logging_kibana_ops_proxy_cpu_limit=null
openshift_logging_kibana_ops_proxy_memory_limit=256Mi
openshift_logging_kibana_ops_proxy_cpu_request=100m
openshift_logging_kibana_ops_replica_count=1

#The absolute path on the control node to the cert file to use
#for the public facing ops kibana certs
openshift_logging_kibana_ops_cert=""

#The absolute path on the control node to the key file to use
#for the public facing ops kibana certs
openshift_logging_kibana_ops_key=""

#The absolute path on the control node to the CA file to use
#for the public facing ops kibana certs
openshift_logging_kibana_ops_ca=""

openshift_logging_fluentd_nodeselector={'logging-infra-fluentd': 'true'}
openshift_logging_fluentd_cpu_limit=null
openshift_logging_fluentd_memory_limit=512Mi
openshift_logging_fluentd_cpu_request=100m
openshift_logging_fluentd_journal_source=""
openshift_logging_fluentd_journal_read_from_head=""
openshift_logging_fluentd_hosts=['--all']
openshift_logging_fluentd_buffer_queue_limit=32
openshift_logging_fluentd_buffer_size_limit=8m

openshift_logging_es_host=logging-es
openshift_logging_es_port=9200
openshift_logging_es_ca=/etc/fluent/keys/ca
openshift_logging_es_client_cert=/etc/fluent/keys/cert
openshift_logging_es_client_key=/etc/fluent/keys/key
openshift_logging_es_cluster_size=1
openshift_logging_es_cpu_limit=null
openshift_logging_es_cpu_request="1"
# the logging appenders for the root loggers to write ES logs. Valid values: 'file', 'console'
openshift_logging_es_log_appenders=['file']
openshift_logging_es_memory_limit="8Gi"
openshift_logging_es_pv_selector="{{ openshift_logging_storage_labels | default('') }}"
openshift_logging_es_pvc_dynamic="{{ openshift_logging_elasticsearch_pvc_dynamic | default(False) }}"
openshift_logging_es_pvc_size=''
openshift_logging_es_pvc_prefix="{{ openshift_logging_elasticsearch_pvc_prefix | default('logging-es') }}"
openshift_logging_es_recover_after_time=5m
openshift_logging_es_storage_group="65534"
openshift_logging_es_nodeselector={}
# openshift_logging_es_config is a hash to be merged into the defaults for the elasticsearch.yaml
openshift_logging_es_config={}

# for exposing es to external (outside of the cluster) clients
openshift_logging_es_allow_external=False
openshift_logging_es_hostname="{{ 'es.' ~ openshift_master_default_subdomain }}"

#The absolute path on the control node to the cert file to use
#for the public facing es certs
openshift_logging_es_cert=""

#The absolute path on the control node to the key file to use
#for the public facing es certs
openshift_logging_es_key=""

#The absolute path on the control node to the CA file to use
#for the public facing es certs
openshift_logging_es_ca_ext=""

# allow cluster-admin or cluster-reader to view operations index
openshift_logging_es_ops_allow_cluster_reader=False

openshift_logging_es_ops_host=logging-es-ops
openshift_logging_es_ops_port=9200
openshift_logging_es_ops_ca=/etc/fluent/keys/ca
openshift_logging_es_ops_client_cert=/etc/fluent/keys/cert
openshift_logging_es_ops_client_key=/etc/fluent/keys/key
openshift_logging_es_ops_cluster_size="{{ openshift_logging_elasticsearch_ops_cluster_size | default(1) }}"
openshift_logging_es_ops_cpu_limit=null
openshift_logging_es_ops_memory_limit="8Gi"
openshift_logging_es_ops_cpu_request="1"
openshift_logging_es_ops_pv_selector="{{ openshift_loggingops_storage_labels | default('') }}"
openshift_logging_es_ops_pvc_dynamic="{{ openshift_logging_elasticsearch_ops_pvc_dynamic | default(False) }}"
openshift_logging_es_ops_pvc_size="{{ openshift_logging_elasticsearch_ops_pvc_size | default('') }}"
openshift_logging_es_ops_pvc_prefix="{{ openshift_logging_elasticsearch_ops_pvc_prefix | default('logging-es-ops') }}"
openshift_logging_es_ops_recover_after_time=5m
openshift_logging_es_ops_storage_group="65534"
openshift_logging_es_ops_nodeselector={}

# for exposing es-ops to external (outside of the cluster) clients
openshift_logging_es_ops_allow_external=False
openshift_logging_es_ops_hostname="{{ 'es-ops.' ~ openshift_master_default_subdomain }}"

#The absolute path on the control node to the cert file to use
#for the public facing es-ops certs
openshift_logging_es_ops_cert=""

#The absolute path on the control node to the key file to use
#for the public facing es-ops certs
openshift_logging_es_ops_key=""

#The absolute path on the control node to the CA file to use
#for the public facing es-ops certs
openshift_logging_es_ops_ca_ext=""

# storage related defaults
openshift_logging_storage_access_modes=['ReadWriteOnce']

# # mux - secure_forward listener service
# openshift_logging_mux_allow_external=False
# openshift_logging_use_mux="{{ openshift_logging_mux_allow_external | default(False) }}"
# openshift_logging_mux_hostname="{{ 'mux.' ~ openshift_master_default_subdomain}}"
# openshift_logging_mux_port=24284
# openshift_logging_mux_cpu_limit=null
# openshift_logging_mux_memory_limit=512Mi
# openshift_logging_mux_cpu_request=100m
# # the namespace to use for undefined projects - users will typically not need to set this
# # extra namespaces to create for mux clients - users will need to set this
# openshift_logging_mux_namespaces=[]

# following can be uncommented to provide values for configmaps -- take care when providing file contents as it may cause your cluster to not operate correctly
# es_logging_contents:
# es_config_contents:
# curator_config_contents:
# fluentd_config_contents:
# fluentd_throttle_contents:
# fluentd_secureforward_contents:
# fluentd_mux_config_contents:
# fluentd_mux_secureforward_contents:



# Create the masters host group. Note that due do:
#   https://github.com/dwmkerr/terraform-aws-openshift/issues/40
# We cannot use the internal DNS names (such as master.openshift.local) as there
# is a bug with the installer when using the AWS cloud provider.
[masters]
${master1_hostname}
${master2_hostname}
${master3_hostname}

# host group for etcd
[etcd]
${master1_hostname}
${master2_hostname}
${master3_hostname}

# host group for nodes, includes region info
[nodes]
${master1_hostname}
${master2_hostname}
${master3_hostname}
${node1_hostname} openshift_hostname=${node1_hostname} openshift_node_labels="{'region': 'primary', 'zone': 'east'}"
${node2_hostname} openshift_hostname=${node2_hostname} openshift_node_labels="{'region': 'primary', 'zone': 'west'}"
${infra1_hostname} openshift_hostname=${infra1_hostname} openshift_node_labels="{'region': 'infra', 'zone': 'default'}"
${infra2_hostname} openshift_hostname=${infra2_hostname} openshift_node_labels="{'region': 'infra', 'zone': 'default'}"
